---
import Icon from "../atoms/icon.astro";
// Swiperのインポート（CSS）
import "swiper/css";
import "swiper/css/navigation";
import "swiper/css/pagination";
// Swiper本体のインポート（JS）
// ※このimportは、Astroのビルド時にバンドルに含まれますが、
// クライアント側スクリプト内での参照とは直接関係しないため、下記スクリプトで再インポートします。

// ここで定義した型は、Astroコンポーネントのフロントマターでのみ有効です。
type ImageItem = {
	url: string;
};

type Category = {
	slug: string;
	title: string;
};

type Tag = {
	slug: string;
	title: string;
};

type Image = {
	title: string;
	images: ImageItem[];
	sizeHorizontal: number;
	sizeVertical: number;
	isPrivate: boolean;
	category: Category;
	tag: Tag[];
};

export interface Props {
	image: Image;
}

const { image } = Astro.props;

const BASE_PATH = "/works/graphicdesign";

const swiperId = `swiper-${Math.random().toString(36).substring(2, 9)}`;
---

<li class="w-[calc(1184px/3_-_32px)] sm:w-full relative">
	{
		image.images && image.images.length > 0 ? (
			<div class="swiper swiper-container js-expand-modal js-em-l " id={swiperId}>
				<div class="swiper-wrapper">
					{image.images.map((img, index) => (
						<div class="swiper-slide expand-img ei-s" style={`max-width: ${image.sizeHorizontal}px;`}>
							<img src={img.url} alt={`${image.title} - ${index + 1}`} class="w-full" loading="lazy" />
						</div>
					))}
				</div>

				{image.images.length > 1 && (
					<>
						<div class="swiper-button-prev swiper-button-color opacity-hover duration" />
						<div class="swiper-button-next swiper-button-color opacity-hover duration" />
						<div class="swiper-pagination" />
					</>
				)}
				<button class="expand-btn absolute bottom-[12px] left-1/2 -translate-x-1/2 bg-[#F8F8F8] text-[12px] sm:text-[10px] font-bold leading-none tracking-[0.04em] text-[#0079C9] opacity-hover duration">
					拡大
					<Icon
						filename="icon_fullscreen"
						color="#0079C9"
						customClass="w-[14px] ml-[4px] sm:w-[12px] align-text-top sm:ml-[2px]"
					/>
				</button>
			</div>
		) : (
			<p>画像データがありません。</p>
		)
	}

	<div
		class="bg-[#eee] inline-block mt-[16px] sm:mt-[12px] font-bold text-[12px] leading-[1] tracking-[0.06em] sm:text-[10px] opacity-hover duration rounded-full"
	>
		<a
			href={`${BASE_PATH}/category/${image.category.slug}`}
			class="px-[20px] pt-[4px] pb-[5px] sm:pb-[4px] inline-block"
		>
			{image.category.title}
		</a>
	</div>

	<p class="text-[16px] sm:text-[14px] mt-[8px] sm:mt-[6px] leading-[1.48] tracking-[0.06em] font-bold">
		{image.title}
	</p>

	<div class="text-[12px] sm:text-[10px] mt-[4px] leading-[1.48] tracking-[0.06em] text-[#666]">
		{
			image.tag.map((t) => (
				<a href={`${BASE_PATH}/tag/${t.slug}`} class="opacity-hover duration">
					<span class="hashtag mr-[6px] sm:mr-[4px]">
						<span>{t.title}</span>
					</span>
				</a>
			))
		}
	</div>
	<div class="text-[13px] sm:text-[11px] mt-[4px] leading-[1.48] tracking-[0.06em] text-[#666]">
		{
			(() => {
				const sizeDisplay = `${image.sizeHorizontal}×${image.sizeVertical}`;
				const sizeSlug = sizeDisplay.replace("×", "x");

				return (
					<a href={`${BASE_PATH}/size/${sizeSlug}`} class="opacity-hover duration">
						<span class="mr-[6px] sm:mr-[4px]">
							<span>{sizeDisplay}</span>
						</span>
					</a>
				);
			})()
		}
	</div>

	{
		image.isPrivate === true && (
			<div class="z-10 absolute top-0 left-0 text-[10px] leading-none tracking-[0.04em] px-[12px] pt-[6px] pb-[8px] font-bold bg-[#eee]">
				自主制作
			</div>
		)
	}
</li>
