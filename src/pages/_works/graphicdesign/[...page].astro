---
import Layout from "../../../layouts/Layout.astro";
import Pager from "../../../components/organisms/pager.astro";
import FilterSection from "../../../components/organisms/filterSection.astro";
import ImageCard from "../../../components/molecules/imageCard.astro";
import { getAllContents } from "../../../libs/microcms";
import type { GetStaticPathsOptions } from "astro";
import type { Image } from "../../../types";
import { getUniqueCategories, getUniqueTags, getUniqueSizes } from "../../../utils/deduplicationUtils";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
	const IMAGES_PER_PAGE = 24;
	const res = await getAllContents<Image>("images");
	const images = res.contents;

	const uniqueCategories = getUniqueCategories(images);
	const uniqueTags = getUniqueTags(images);
	const uniqueSizes = getUniqueSizes(images);

	const paginatedPages = paginate(images, {
		pageSize: IMAGES_PER_PAGE,
		params: {},
		props: {
			totalCount: res.totalCount,
			perPage: IMAGES_PER_PAGE,
			uniqueSizes,
			uniqueCategories,
			uniqueTags,
		},
	});

	paginatedPages.unshift({
		params: { page: undefined },
		props: paginatedPages[0].props,
	});

	return paginatedPages;
}

const { page, totalCount, perPage, uniqueSizes, uniqueCategories, uniqueTags } = Astro.props as {
	page: { data: Image[] };
	totalCount: number;
	perPage: number;
	uniqueSizes: string[];
	uniqueCategories: { slug: string; title: string; enTitle: string }[];
	uniqueTags: { slug: string; title: string; enTitle: string }[];
};

const images = page.data;
---

<Layout
	title="Web制作の実績[画像]｜デザインもできるフロントエンドエンジニアのポートフォリオ"
	breadcrumb={true}
	isImagesPage={true}
	navigation={true}
>
	<main class="inner relative pt-[96px] sm:pt-[48px] pb-[120px] sm:pb-[64px]">
		<h1 class="text-[32px] sm:text-[24px] font-black leading-[1.4] tracking-[0.04em] break-normal">
			Graphic Design<span class="sm:hidden tracking-[0.08em]">｜グラフィックデザイン</span>
			<span class="font-normal bracket">All</span>
		</h1>
		<FilterSection uniqueCategories={uniqueCategories} uniqueSizes={uniqueSizes} uniqueTags={uniqueTags} />
		<ul class="flex flex-wrap gap-[48px] sm:gap-[32px] mt-[48px] sm:mt-[36px]">
			{images.map((image) => <ImageCard image={image} />)}
		</ul>
		<div class="mt-[48px]">
			<Pager page={page} totalCount={totalCount} basePath="/works/graphicdesign" perPage={perPage} />
		</div>
	</main>
</Layout>
